{% extends "frontend/base.html" %}
{% load staticfiles %}
{% block content %}
        <nav aria-label="breadcrumb ">
            <ol class="breadcrumb p-0 mb-3" style="background-color: #EEE;">
                <li class="h5 breadcrumb-item p-2 m-0"><a href="/dashboard">Dashboard</a></li>
                <li class="h5 breadcrumb-item p-2 m-0"><a href="/perimetre/{{ perimetre.id }}"> {{perimetre.name}} </a></li>
                <li class="h5 breadcrumb-item p-2 m-0 active" aria-current="page" style="background-color: #FA5858; color: white;">
                    {{ vuln.name }}
                </li>
            </ol>
        </nav>

        <div id="top-row" class="row">

            <div id="right-col" class="col col-xl-4">
                <div id="radar-box">
                    <p class="h5">
                        <a href="#" class="badge badge-pill badge-primary">{{ vuln.get_theme_display }}</a>
                    </p>

                    <div class="d-flex">
                        <div class="h5 p-1 flex-fill">
                            Opening date: <strong>{{ vuln.created_at |date:"N j, o" }}</strong>
                        </div>

                        <div class="h5 p-1 flex-fill">
                            Status: <strong><span
                                class="oi oi-shield text-success"></span>&nbsp;{{ vuln.get_state_display }}</strong>
                        </div>
                    </div>

                    <div class="d-flex">
                        <div class="h5 p-1 flex-fill">
                            Holder&nbsp;:
                            <strong><span class="oi oi-code"></span>&nbsp;{{ vuln.get_porteur_display }}</strong>
                        </div>

                        <div class="h5 p-1 flex-fill">
                            Priority&nbsp;:
                            <strong><span class="oi oi-caret-top"></span>&nbsp;{{ vuln.get_priority_display }}</strong>
                        </div>
                    </div>

                    <canvas id="cvss-radar"></canvas>

                </div>
                <!-- #radar-box -->

                <div class="mt-2">
                    <table class="table table-sm">
                     <thead>
                        <tr>
                          <th scope="col" style="width: 50%">CVSS metric</th>
                          <th scope="col" style="width: 50%">Value</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>AV − Attack Vector</td>
                          <td class="text-danger font-weight-bold">{{vuln.get_vector_display }}</td>
                        </tr>
                        <tr>
                          <td>AC − Attack Complexity</td>
                          <td class="text-danger font-weight-bold">{{vuln.get_complexity_display}}</td>
                        </tr>
                        <tr>
                            <td>PR − Privileges Required</td>
                            <td class="text-warning font-weight-bold">{{vuln.get_privileges_display}}</td>
                        </tr>
                        <tr>
                            <td>UI − User Interaction</td>
                            <td class="text-danger font-weight-bold">{{vuln.get_interaction_display}}</td>
                        </tr>
                        <tr>
                            <td>S − Scope</td>
                            <td class="text-success font-weight-bold">{{vuln.get_scope_display}}</td>
                        </tr>
                        <tr>
                            <td>C − Confidentiality</td>
                            <td class="text-danger font-weight-bold">{{vuln.get_confidentiality_display}}</td>
                        </tr>
                        <tr>
                            <td>I − Integrity</td>
                            <td class="text-danger font-weight-bold">{{vuln.get_integrity_display}}</td>
                        </tr>
                        <tr class="border-bottom">
                            <td>A − Availability</td>
                            <td class="text-warning font-weight-bold">{{vuln.get_availability_display}}</td>
                        </tr>
                      </tbody>
                    </table>
                </div>
            </div>
            <!-- #right-col -->

            <div id="left-col" class="col col-12 col-xl-8 border-left">
                <div id="description">
                    <h2>Description</h2>
                    {{vuln.description | safe}}
                </div>
                <!-- #description -->

                <hr />
                 {% if video %}
                <div id="demonstration">
                    <h2>Illustration</h2>

                    <p>{{video.description}}</p>
                    <div class="embed-responsive embed-responsive-21by9" >
                     <video class="embed-responsive-item" controls src="{{video.file.url}}">
                        <!--<source src="/static/video/injection_sql.mkv" /> -->
                     </video>
                    </div>
                </div>
                {% else %}
                <div id="demonstration">
                    <h2>Illustration</h2>
                    <p>{{text}}</p>
                </div>
                {% endif %}

                <hr />

                <div id="reproduction">
                    <h2>Modus operandi</h2>

                    {{vuln.mode_operatoire|safe}}
                </div>
                <!-- #reproduction -->

                <hr />

                <div id="recommandation">
                    <div class="d-flex">
                        <h2 class="pr-4">Recommendation</h2>
                        <div class="pr-4 align-self-center">
                            Porteurs&nbsp;:
                            <strong><span class="oi oi-code"></span>&nbsp;{{ vuln.get_porteur_display }}</strong>
                        </div>

                        <div class="d-fill align-self-center">
                            Priority&nbsp;:
                            <strong><span class="oi oi-caret-top"></span>&nbsp;{{ vuln.get_priority_display }}</strong>
                        </div>
                    </div>

                    {{vuln.recommendation|safe}}
                </div>
                <!-- #recommandation -->
            </div>
            <!-- #left-col -->
        </div>
        <!-- #top-row -->
    </div>
    <!-- #top-container -->
{% endblock %}

{% block javascript_block %}
    <script src="/static/data/cvss-data.js" type="text/javascript"></script>
    <script type="text/javascript">
        var ctx = document.getElementById('cvss-radar').getContext('2d');
        var myChart = null;

        var drawCharts = function() {
            console.log("drawing…");
            if (myChart != null) {
                myChart.destroy();
            }
            myChart = new Chart(ctx, {
                type : 'radar',
                data : cvssData,
                options : {
                    responsive : true,
                    legend : {
                        display : false
                    },
                    title : {
                        fontSize : 18,
                        display : false,
                        text : 'Détail CVSS'
                    },
                    scale : {
                        pointLabels : {
                            fontSize : 10,
                        },
                        ticks : {
                            display : false,
                            beginsAtZero : true
                        }
                    }
                }
            });
        }

        $(window).ready(drawCharts);
        $(window).resize(function() {
            console.log("resizing…");
            drawCharts();
        });
    </script>
{% endblock %}
