{% extends "frontend/base.html" %}

{% block title %}Périmètres{% endblock %}

{% block content %}
		<nav aria-label="breadcrumb ">
			<ol class="breadcrumb p-0 mb-3" style="background-color: #EEE;">
				<li class="h5 breadcrumb-item active p-2 m-0">Tableau de bord</li>
			</ol>
		</nav>

		<div id="top-row" class="row">
			<div id="left-col" class="col col-12 col-xl-8">

				<div class="row">
					<div class="col col-12 col-md-8">
						<form id="search-form" action="">
							<div class="form-group mb-1">
								<label class="sr-only" for="search-form-input">Rechercher...</label>
								<div class="input-group">
									<div class="input-group-prepend">
										<div class="input-group-text">
											<span class="oi oi-magnifying-glass"></span>
										</div>
									</div>
									<input type="text" class="form-control" id="search-form-input"
										placeholder="Rechercher..." value="{{ filter_value }}">
									<div class="input-group-append">
										<button type="button" class="btn btn-outline-secondary"
											aria-label="Close">
											<span class="oi oi-x"></span>
										</button>
									</div>
								</div>
							</div>
						</form>

						<div id="result-control" class="d-flex p-0 m-0">
							<div class="ml-1 mr-4 p-0">
								Trié par : <strong>date</strong>&nbsp;<span class="oi oi-caret-bottom m-1"></span>
							</div>
							<div class="mr-4 p-0">
							 	Groupé par : <strong>entité</strong>&nbsp;<span class="oi oi-caret-bottom m-1"></span>
							</div>
						</div>
					</div>

					<div class="col col-12 col-md-4">
						<button type="button" class="btn btn-primary btn-block">
							<span class="oi oi-plus mr-2 ml-2"></span>&nbsp;Nouveau périmètre
						</button>
					</div>
				</div>

				<!-- #search-form -->


				<hr class="p-0 m-2" />

				<div id="cards" class="d-flex flex-wrap justify-content-center">
					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: orange;"
						onclick="window.location.href = window.location.pathname = '/perimetre?id=1';">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">
									Gestionnaire de rapports
								</div>
								<div>
									<a href="/dashboard?filter=finaudit" class="badge badge-primary">finaudit</a>
									<a href="#" class="badge badge-pill badge-secondary">avec compte</a>
								</div>
							</div>

							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">1</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">3</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">1</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 1 -->
					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: #ffff00;">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">
									Système de paiement
								</div>
								<div>
									<a href="index-filtered.html" class="badge badge-primary">finaudit</a>
								</div>
							</div>
							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">0</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">2</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">8</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 3 -->

					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: red;">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">
									Site web vitrine
								</div>
								<div>
									<a href="#" class="badge badge-primary">commerciale</a>
								</div>
							</div>
							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">4</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">9</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">4</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 2 -->

					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: red;">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">
									Boutique en ligne
								</div>
								<div>
									<a href="#" class="badge badge-primary">commerciale</a>
								</div>
							</div>
							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">1</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">3</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">1</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 2 -->



					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: #ffff00;">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">Visioconférence</div>
								<div>
									<a href="#" class="badge badge-primary">services</a>
									<a href="#" class="badge badge-pill badge-secondary">avec compte</a>
									<a href="#" class="badge badge-pill badge-secondary">avec code</a>
								</div>
							</div>
							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">1</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">2</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">2</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 4 -->

					<div class="card card-bb mb-3 m-1 shadow card-bb"
						style="border-color: #ffff00;">
						<div class="card-body card-body-bb">
							<div class="card-header-bb">
								<div class="h5">Accès externe</div>
								<div>
									<a href="#" class="badge badge-primary">services</a> <a
										href="#" class="badge badge-pill badge-secondary">avec compte</a>
								</div>
							</div>
							<div class="card-text">
								<div class="row">
									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-maj">0</span>
										<br /> <small>majeures</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-mod">2</span>
										<br /> <small>modérées</small>
									</div>

									<div class="col col-4 text-center">
										<span class="h1 font-weight-bold card-number card-number-min">2</span>
										<br /> <small>mineures</small>
									</div>
								</div>
								<!-- row -->
							</div>
							<!-- card-text -->
						</div>
						<!-- card-body -->
					</div>
					<!-- card 5 -->
				</div>
				<!-- #cards -->
			</div>
			<!-- #left-col -->

			<div id="right-col" class="col col-12 col-xl-4 border-left">
				<div id="charts" class="row p-2">
					<div id="categories-chart" class="col col-12">
						<canvas id="myChart" style="width: 100%"></canvas>
					</div>
					<!-- #categories-chart -->
					<div id="pie-chart" class="col col-12">
						<canvas id="myChart2" style="width: 100%"></canvas>
					</div>
					<!-- #pie-chart -->
				</div>
				<!-- #charts -->
			</div>
			<!-- #right-col -->
		</div>
		<!-- #top-row -->
	</div>
	<!-- #top-container -->
{% endblock %}

{% block javascript_block %}
	{{ datas | safe }}
	<script type="text/javascript">
		Chart.defaults.global.plugins.datalabels.display = function(context) {
			var value = context.dataset.data[context.dataIndex];
			return value === 0 ? false : true;
		};
		Chart.defaults.global.legend.onClick = function() {
		};

		var ctx = document.getElementById('myChart').getContext('2d');
		var pieCtx = document.getElementById('myChart2').getContext('2d');
		var myChart = null;
		var myPieChart = null;

		var drawCharts = function() {
			console.log("drawing…");
			if (myChart != null) {
				myChart.destroy();
			}
			myChart = new Chart(ctx, {
				type : 'horizontalBar',
				data : barData,
				options : {
					title : {
						display : true,
						fontSize: 20,
						text : 'Vulnérabilités découvertes'
					},
					tooltips : {
						mode : 'index',
						intersect : false
					},
					responsive : true,
					legend : {
						position : 'bottom'
					},
					scales : {
						xAxes : [ {
							stacked : true,
							ticks : {
								stepSize : 1
							}
						} ],
						yAxes : [ {
							stacked : true,
							ticks : {
								stepSize : 1
							}
						} ]
					}
				}
			});
			if (myPieChart != null) {
				myPieChart.destroy();
			}
			myPieChart = new Chart(pieCtx, {
				type : 'doughnut',
				data : pieData,
				options : {
					title : {
						display : false,
					},
					tooltips : {
						mode : 'index',
						intersect : false
					},
					responsive : true,
					legend : {
						display : false,
					},
				    plugins: {
				    	datalabels: {
				    		font: {
				    			size: 25
				    		}
				    	},
				        doughnutlabel: {
				          labels: [pieData.datasets[0].data.reduce(function (a, b) {return a + b;}, 0)],
				          font: {
				                      size: '40',
				                      family: 'Helvetica, sans-serif',
				                      weight: 'bold'
				          },
				          color: 'grey'
				        }
				   }
				}
			});
		};
		$(window).ready(drawCharts);
		$(window).resize(function() {
			console.log("resizing…");
			drawCharts();
		});
	</script>
{% endblock %}
